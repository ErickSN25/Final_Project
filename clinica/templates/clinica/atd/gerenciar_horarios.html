{% extends "clinica/atd/base_atendente.html" %}

{% block content %}
<div class="container">
    <h2>Gerenciar Horários</h2>

    <!-- ========== FORMULÁRIO DE FILTROS ========== -->
    <form method="get" id="filtroForm" class="filtro-form">
        <label for="{{ filtro_form.veterinario.id_for_label }}">Veterinário</label>
        {{ filtro_form.veterinario }}

        <label for="{{ filtro_form.data.id_for_label }}">Data</label>
        {{ filtro_form.data }}

          <div class="form-group checkbox-group">
                {{ filtro_form.apenas_disponiveis }}
                <label for="{{ filtro_form.apenas_disponiveis.id_for_label }}">Apenas Disponíveis</label>
            </div>

        <button type="submit" class="btn btn-success">Buscar</button>
        <a href="{% url 'gerenciar_horarios' %}" class="btn btn-outline">Limpar Filtros</a>
    </form>

    {% if request.GET %}
    <div class="alert alert-info">
        Encontrado(s) <strong>{{ horarios.count }}</strong> horário(s) com os filtros aplicados.
    </div>
    {% endif %}
    <!-- ========== FIM DO FORMULÁRIO ========== -->

    <!-- Botão criar horário novo -->
    <div class="mb-3">
        <a href="{% url 'criar_horario' %}" class="btn btn-success">Criar Horário Novo</a>
    </div>

    <!-- Tabela de horários -->
    <table class="tabela-horarios">
        <thead>
            <tr>
                <th>ID</th>
                <th>Veterinário</th>
                <th>Data e Hora</th>
                <th>Status</th>
                <th>Cliente</th>
                <th>Pet</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for horario in horarios %}
            <tr>
                <td>{{ horario.id }}</td>
                <td>{{ horario.veterinario.nome }}</td>
                <td>{{ horario.data|date:"d/m/Y H:i" }}</td>
                <td>{% if horario.disponivel %}Disponível{% else %}Reservado{% endif %}</td>
                <td>{% if horario.consulta %}{{ horario.consulta.pet.tutor.nome }}{% else %}-{% endif %}</td>
                <td>{% if horario.consulta %}{{ horario.consulta.pet.nome }}{% else %}-{% endif %}</td>
                <td>
                    <a href="{% url 'editar_horario' horario.id %}" class="btn btn-primary btn-table">Editar</a>
                    <a href="{% url 'excluir_horario' horario.id %}" class="btn btn-danger btn-table">Excluir</a>
                    {% if horario.disponivel %}
                        <a href="{% url 'reservar_horario' horario.id %}" class="btn btn-success btn-table">Reservar</a>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">Nenhum horário encontrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<!-- Paginação -->
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.veterinario %}&veterinario={{ request.GET.veterinario }}{% endif %}{% if request.GET.data %}&data={{ request.GET.data }}{% endif %}{% if request.GET.apenas_disponiveis %}&apenas_disponiveis={{ request.GET.apenas_disponiveis }}{% endif %}">Anterior</a>
    {% endif %}

    <span>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.veterinario %}&veterinario={{ request.GET.veterinario }}{% endif %}{% if request.GET.data %}&data={{ request.GET.data }}{% endif %}{% if request.GET.apenas_disponiveis %}&apenas_disponiveis={{ request.GET.apenas_disponiveis }}{% endif %}">Próxima</a>
    {% endif %}
</div>
<!-- ================== CSS ================== -->
<style>
body { font-family: Arial, sans-serif; background-color: #f5f5f5; }
.container { width: 90%; margin: 30px auto; }
h2 { margin-bottom: 20px; color: #333; }

.filtro-form {
    background-color: #fff;
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: flex-end;
}
.filtro-form label { font-weight: bold; margin-bottom: 5px; display: block; }
.filtro-form select, .filtro-form input { padding: 6px; border-radius: 4px; border: 1px solid #ccc; }

.btn { display: inline-block; padding: 6px 12px; font-size: 14px; text-decoration: none; border-radius: 4px; color: #fff; cursor: pointer; margin-top: 5px; }
.btn-success { background-color: #28a745; }
.btn-primary { background-color: #007bff; }
.btn-danger { background-color: #dc3545; }
.btn-outline { background-color: #fff; color: #333; border: 1px solid #ccc; }
.btn:hover { opacity: 0.9; }

.tabela-horarios {
    width: 100%;
    border-collapse: collapse;
    background-color: #fff;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.tabela-horarios th, .tabela-horarios td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}
.tabela-horarios th {
    background-color: #f0f0f0;
    font-weight: bold;
}
.btn-table { margin: 2px; }
.alert-info {
    padding: 10px;
    background-color: #d1ecf1;
    border: 1px solid #bee5eb;
    border-radius: 4px;
    color: #0c5460;
    margin-bottom: 10px;
}
</style>
{% endblock %}
